<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Caça Palavras - MusiKids Fun</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Baloo+2&display=swap');
  body {
    margin: 0; padding: 0; min-height: 100vh;
    font-family: 'Baloo 2', cursive, Arial, sans-serif;
    background: linear-gradient(135deg,#f7f4e9,#f8b500,#ff7eb9 100%);
    color: #32434a; user-select: none;
    box-sizing: border-box; text-align: center;
  }
  #btn-menu {
    position: fixed; top: 15px; left: 15px;
    background: #a1d578; color: #214d0d;
    border-radius: 18px; padding: 14px 22px;
    font-weight: 900; font-size: 1.25rem;
    cursor: pointer; box-shadow: 0 0 15px #a1d578aa;
    border: none; user-select: none; z-index: 10000;
    transition: background-color .3s ease;
  }
  #btn-menu:hover { background: #68922b; color: white; }
  header {
    margin-top: 75px; font-weight: 900; font-size: 2.4rem;
    color: #d63a6d; user-select: none;
    margin-bottom: 16px;
  }
  main {
    max-width: 950px;
    margin: 0 auto;
    background: white;
    border-radius: 28px;
    box-shadow: 0 4px 18px #ffd3e466;
    padding: 20px 18px 30px 18px;
    display: flex;
    gap: 28px;
    flex-direction: row;
    justify-content: center;
    align-items: flex-start;
  }
  .panel {
    width: 170px;
    min-width: 135px;
    background: #fcf4ff;
    border-radius: 23px;
    padding: 16px 8px 24px 8px;
    box-shadow: 0 3px 12px #ffd1e2aa;
    text-align: left;
  }
  .panel h3 { font-size: 1.15rem; color: #ff7eb9; margin-bottom: .5rem; font-weight: 800; }
  .panel ul {
    list-style: none; padding: 0; margin: 0;
    font-size: 1.21rem; color: #4c6d8c; font-weight: 700;
  }
  .panel-found { background: #e7ffd2; }
  #grid-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; }
  #grid {
    display: grid; gap: 4px;
    background: #f6ebff; border-radius: 20px;
    padding: 18px; box-shadow: 0 0 12px #e7abd7a6;
    margin-bottom: 20px;
  }
  .grid-cell {
    width: 38px; height: 38px;
    background: #fff5ea; border-radius: 11px;
    font-size: 1.42rem; font-weight: 800;
    color: #5e219b; box-shadow: 0 0 6px #fdafb855;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: background-color .3s, color .3s;
    user-select: none;
  }
  .grid-cell.found { color: white; font-weight: 900; }
  .grid-cell.selected { background: #d3d3d3; color: #fff; }
  #result-text {
    font-size: 1.3rem; color: #d63a6d; margin: 14px 0 0 0;
    font-weight: 700;
  }
  #btn-novo {
    background: #e4bafe; color: #6121a9;
    border: none; border-radius: 19px; font-weight: 900;
    font-size: 1.17rem; box-shadow: 0 3px 12px #edbbdb88;
    padding: 12px 38px; margin-top: 18px; cursor: pointer;
    transition: background-color .3s;
  }
  #btn-novo:hover {background: #912ba2; color: #fff;}
</style>
</head>
<body>
<button id="btn-menu" aria-label="Voltar ao menu">MENU DE JOGOS</button>
<header>Caça Palavras - MusiKids Fun</header>
<main>
  <div class="panel">
    <h3>Encontrar:</h3>
    <ul id="palavras-alvo"></ul>
  </div>
  <div id="grid-wrap">
    <div id="grid"></div>
    <div id="result-text"></div>
    <button id="btn-novo" style="display:none;">Novo Jogo</button>
  </div>
  <div class="panel panel-found">
    <h3>Encontradas:</h3>
    <ul id="palavras-achadas"></ul>
  </div>
</main>
<div id="confetti"></div>
<script>
const PALAVRAS = [
"ANJO","CACHORRO","GATO","JARDIM","CARRO","TIGRE","CAJU","BORBOLETA","PATO","CASA","FELICIDADE","CERTO","JANELA","SORRISO","CORAÇÃO","LARANJA","AMOR","PASSARINHO","AMIZADE","VACA","SOL","VERDE","FAMÍLIA","FLOR","ESCOLA","PEIXE","ARVORE","CEBOLA","SAPO","TERRA","AMARELO","AZUL","ROSA","NAVIO","ONÇA","LIVRO","GEMA","BANANA","FOFO","CEREJA","FITA","CAIXA","PAPAI","MAMÃE","ELEFANTE","BRINQUEDO","BOLA","TESOURA","BACIA"
];

const CORES = [
  "#ff7eb9","#bcebff","#e7ffd2","#ffd0d3","#b8b9ff","#fdffa9","#b9faf8","#f9b9ff",
  "#ffd9ae","#baffda","#fbb1b1","#e3cdff","#fdf07a","#f7bbe6","#7ef5be","#ccecff"
];

const TAMANHO = 12;

const btnMenu = document.getElementById("btn-menu");
const gridElem = document.getElementById("grid");
const alvoElem = document.getElementById("palavras-alvo");
const achadasElem = document.getElementById("palavras-achadas");
const resultText = document.getElementById("result-text");
const btnNovo = document.getElementById("btn-novo");

btnMenu.onclick = () => location.href = "../index.html";

let palavrasAtivas = [], encontradas = [], gridData = [], corDasPalavras = {};
let selecao = [];
let isDragging = false;

function shuffle(arr) {
  return arr.map(i=>[Math.random(),i]).sort((a,b)=>a[0]-b[0]).map(i=>i[1]);
}

function sorteiaPalavras() {
  return shuffle(PALAVRAS).slice(0,10);
}

function iniciaGrid() {
  gridData = Array(TAMANHO).fill(0).map(()=>Array(TAMANHO).fill(''));
  corDasPalavras = {};

  palavrasAtivas.forEach((palavra, idx) => {
    let colocada = false, tentativas = 0, modo = Math.random() > 0.5 ? 'H' : 'V';
    const cor = CORES[idx % CORES.length];
    corDasPalavras[palavra] = cor;
    while(!colocada && tentativas<40) {
      if(modo==='H') {
        let row = Math.floor(Math.random() * TAMANHO);
        let col = Math.floor(Math.random() * (TAMANHO-palavra.length+1));
        let cabem = true;
        for(let k=0;k<palavra.length;k++) {
          const letra = gridData[row][col+k];
          if(letra && letra!==palavra[k]) { cabem=false; break; }
        }
        if(cabem) {
          for(let k=0;k<palavra.length;k++) gridData[row][col+k]=palavra[k];
          colocada=true;
        }
      }
      else {
        let row = Math.floor(Math.random() * (TAMANHO-palavra.length+1));
        let col = Math.floor(Math.random() * TAMANHO);
        let cabem = true;
        for(let k=0;k<palavra.length;k++) {
          const letra = gridData[row+k][col];
          if(letra && letra!==palavra[k]) {cabem=false;break;}
        }
        if(cabem) {
          for(let k=0;k<palavra.length;k++) gridData[row+k][col]=palavra[k];
          colocada=true;
        }
      }
      tentativas++;
      if(tentativas===20) modo = modo==='H'?'V':'H';
    }
  });
  for(let i=0;i<TAMANHO;i++)
    for(let j=0;j<TAMANHO;j++)
      if(!gridData[i][j])
        gridData[i][j] = String.fromCharCode(65+Math.floor(Math.random()*26));
}

function desenhaGrid() {
  gridElem.innerHTML = '';
  gridElem.style.gridTemplateColumns = `repeat(${TAMANHO}, 1fr)`;
  gridElem.style.gridTemplateRows = `repeat(${TAMANHO}, 1fr)`;
  for(let i=0;i<TAMANHO;i++) {
    for(let j=0;j<TAMANHO;j++) {
      let cell = document.createElement('div');
      cell.className = 'grid-cell';
      cell.textContent = gridData[i][j];
      cell.dataset.row = i; cell.dataset.col = j;
      cell.addEventListener('click', handleClick);
      gridElem.appendChild(cell);
    }
  }
}

function desenhaPainel() {
  alvoElem.innerHTML = '';
  achadasElem.innerHTML = '';
  palavrasAtivas.forEach(p=> {
    if(encontradas.includes(p)) return;
    let li = document.createElement('li');
    li.textContent = p;
    alvoElem.appendChild(li);
  });
  encontradas.forEach((p,idx)=> {
    let li = document.createElement('li');
    li.innerHTML = `<span style="padding:3px 8px;border-radius:9px;background:${corDasPalavras[p]};color:#fff;">${p}</span>`;
    achadasElem.appendChild(li);
  });
}

function reiniciaJogo() {
  palavrasAtivas = sorteiaPalavras();
  encontradas = [];
  iniciaGrid();
  desenhaGrid();
  desenhaPainel();
  resultText.textContent = '';
  btnNovo.style.display = 'none';
  Array.from(document.querySelectorAll('.grid-cell')).forEach(cell=>cell.classList.remove('found', 'selected'));
  selecao = [];
  isDragging = false;
}

function verificaPalavraSelecionada(indices) {
  let texto = indices.map(([i,j])=>gridData[i][j]).join('');
  let textoInvert = indices.map(([i,j])=>gridData[i][j]).reverse().join('');
  for(let palavra of palavrasAtivas) {
    if((texto===palavra || textoInvert===palavra) && !encontradas.includes(palavra)) {
      destacando(indices, corDasPalavras[palavra]);
      encontradas.push(palavra);
      desenhaPainel();
      if(encontradas.length===palavrasAtivas.length) {
        resultText.textContent = 'Parabéns! Encontrou todas!';
        btnNovo.style.display = "inline-block";
        btnNovo.focus();
        confetti();
      }
      clearSelection();
      return true;
    }
  }
  return false;
}

function destacando(indices, cor) {
  indices.forEach(([i,j])=>{
    Array.from(gridElem.children).forEach(cell=>{
      if(Number(cell.dataset.row)===i && Number(cell.dataset.col)===j) {
        cell.classList.remove('selected');
        cell.classList.add('found');
        cell.style.background=cor;
        cell.style.color="#fff";
      }
    });
  });
}

function handleClick(e) {
  if (isDragging) return;
  const cell = e.target;
  if (!cell.classList.contains('grid-cell')) return; // permite selecionar mesmo que já encontrou

  const row = Number(cell.dataset.row);
  const col = Number(cell.dataset.col);

  if (selecao.length === 0) {
    selecao = [[row, col]];
    cell.classList.add('selected');
  } else {
    const last = selecao[selecao.length - 1];
    const isValid = isValidNextClick(last[0], last[1], row, col);

    if (isValid) {
      selecao.push([row, col]);
      cell.classList.add('selected');
      if (verificaPalavraSelecionada(selecao)) {
        clearSelection();
      }
    } else {
      clearSelection();
      selecao = [[row, col]];
      cell.classList.add('selected');
    }
  }
}

function isValidNextClick(lastRow, lastCol, newRow, newCol) {
  if (selecao.length === 1) {
    return Math.abs(lastRow - newRow) <= 1 && Math.abs(lastCol - newCol) <= 1 && !(lastRow === newRow && lastCol === newCol);
  }
  const first = selecao[0];
  const second = selecao[1];
  const rowDiff = second[0] - first[0];
  const colDiff = second[1] - first[1];

  const expectedRow = lastRow + rowDiff;
  const expectedCol = lastCol + colDiff;

  return newRow === expectedRow && newCol === expectedCol;
}

function clearSelection() {
  Array.from(document.querySelectorAll('.grid-cell')).forEach(cell => cell.classList.remove('selected'));
  selecao = [];
}

gridElem.addEventListener('mousedown', (e)=>{
  if(e.target.classList.contains('grid-cell')) {
    isDragging = true;
    clearSelection();
    selecao = [[Number(e.target.dataset.row), Number(e.target.dataset.col)]];
    e.target.classList.add('selected');
    gridElem.addEventListener('mousemove', mousemove);
  }
});
document.addEventListener('mouseup', ()=>{
  if(isDragging && selecao.length>1) verificaPalavraSelecionada(selecao);
  clearSelection();
  gridElem.removeEventListener('mousemove', mousemove);
  isDragging = false;
});

function mousemove(e){
  if(isDragging && e.target.classList.contains('grid-cell')) {
    let inicio = selecao[0];
    let fim = [Number(e.target.dataset.row),Number(e.target.dataset.col)];
    selecao = [];
    if(inicio[0]===fim[0]) {
      let a = inicio[1], b = fim[1];
      let arr = []; for(let k=Math.min(a,b);k<=Math.max(a,b);k++) arr.push([inicio[0],k]);
      selecao = arr;
    } else if(inicio[1]===fim[1]) {
      let a = inicio[0], b = fim[0];
      let arr=[]; for(let k=Math.min(a,b);k<=Math.max(a,b);k++) arr.push([k,inicio[1]]);
      selecao = arr;
    }
    Array.from(document.querySelectorAll('.grid-cell')).forEach(cell => cell.classList.remove('selected'));
    selecao.forEach(([i,j])=>{
      Array.from(gridElem.children).forEach(cell=>{
        if(Number(cell.dataset.row)===i && Number(cell.dataset.col)===j) {
          cell.classList.add('selected');
        }
      });
    });
  }
}

gridElem.addEventListener('touchstart', (e)=>{
  e.preventDefault();
  if(e.target.classList.contains('grid-cell')) {
    isDragging = true;
    clearSelection();
    selecao = [[Number(e.target.dataset.row), Number(e.target.dataset.col)]];
    e.target.classList.add('selected');
    gridElem.addEventListener('touchmove', touchmove, { passive: false });
  }
});
document.addEventListener('touchend', ()=>{
  if(isDragging && selecao.length>1) verificaPalavraSelecionada(selecao);
  clearSelection();
  gridElem.removeEventListener('touchmove', touchmove);
  isDragging = false;
});

function touchmove(e){
  e.preventDefault();
  const touch = e.touches[0];
  const target = document.elementFromPoint(touch.clientX, touch.clientY);
  if(isDragging && target.classList.contains('grid-cell')) {
    let inicio = selecao[0];
    let fim = [Number(target.dataset.row),Number(target.dataset.col)];
    selecao = [];
    if(inicio[0]===fim[0]) {
      let a = inicio[1], b = fim[1];
      let arr = []; for(let k=Math.min(a,b);k<=Math.max(a,b);k++) arr.push([inicio[0],k]);
      selecao = arr;
    } else if(inicio[1]===fim[1]) {
      let a = inicio[0], b = fim[0];
      let arr=[]; for(let k=Math.min(a,b);k<=Math.max(a,b);k++) arr.push([k,inicio[1]]);
      selecao = arr;
    }
    Array.from(document.querySelectorAll('.grid-cell')).forEach(cell => cell.classList.remove('selected'));
    selecao.forEach(([i,j])=>{
      Array.from(gridElem.children).forEach(cell=>{
        if(Number(cell.dataset.row)===i && Number(cell.dataset.col)===j) {
          cell.classList.add('selected');
        }
      });
    });
  }
}

btnNovo.onclick = ()=>{reiniciaJogo()};

function confetti() {
  const container = document.getElementById("confetti");
  container.innerHTML = "";
  const colors = ["#ff597f", "#ff9ea1", "#fcd677", "#a9d97a", "#79d79a"];
  for (let i = 0; i < 150; i++) {
    const c = document.createElement("div");
    c.className = "confetti-piece";
    c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    c.style.top = Math.random() * -100 + "px";
    c.style.left = Math.random() * window.innerWidth + "px";
    c.style.width = Math.random() * 10 + 5 + "px";
    c.style.height = Math.random() * 10 + 5 + "px";
    c.style.position = "absolute";
    c.style.borderRadius = "50%";
    c.style.animation = `fall ${Math.random() * 2 + 2}s linear forwards`;
    c.style.transform = `rotate(${Math.random() * 360}deg)`;
    container.appendChild(c);
  }
  setTimeout(() => {
    container.innerHTML = "";
  }, 4000);
}
const style = document.createElement("style");
style.innerHTML = `
  @keyframes fall {
    0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) translateX(${Math.random() * 100 - 50}px) rotate(360deg); opacity: 0; }
  }
`;
document.head.appendChild(style);

reiniciaJogo();
</script>
</body>
</html>
