<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Continhas - Teclado Funcional Corrigido - MusiKids</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Luckiest+Guy&display=swap');
  
  body {
    margin: 0; padding: 0;
    font-family: 'Baloo 2', cursive, Arial, sans-serif;
    background: linear-gradient(135deg,#f7f4e9,#ffe7f0);
    color: #444;
    user-select: none;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh; box-sizing: border-box;
  }

  /* --- PLAYER MUSIKIDS --- */
  #musikids-player-card {
    background: white; padding: 6px 15px; display: flex; align-items: center; gap: 10px;
    border: 3px solid #FF77A9; border-radius: 50px; position: fixed; top: 10px; right: 10px; 
    z-index: 10001; box-shadow: 0 4px 15px rgba(0,0,0,0.15);
  }
  .player-controls { display: flex; gap: 6px; align-items: center; }
  .player-btn {
    background: #FF77A9; border: none; color: white; width: 30px; height: 30px; 
    border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
    font-size: 14px;
  }
  .player-label { font-weight: 800; color: #FF4C8B; font-size: 0.8rem; }
  .btn-shuffle.active { background: #21a7ff !important; }

  #btn-menu {
    position: fixed; top: 15px; left: 15px;
    background: #a1d578; color: #214d0d;
    border: none; border-radius: 20px;
    padding: 12px 18px; font-weight: 900;
    font-size: 1.1rem; cursor: pointer;
    box-shadow: 0 3px 16px #a1d578aa; z-index: 1000;
  }

  header {
    font-size: 2.4rem; font-weight: 900;
    margin: 80px 0 10px 0; color: #de1e7e;
    text-align: center;
  }

  main {
    width: 95%; max-width: 540px;
    background: #fffaf8; border-radius: 25px;
    padding: 30px 20px; box-shadow: 0 3px 15px #fcdbe3;
    display: flex; flex-direction: column; gap: 20px; align-items: center;
    margin-bottom: 20px;
  }

  #simple-sum { font-size: 3rem; font-weight: 900; color: #4a977d; text-align: center; }

  .answer-section { display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap; }

  input#answer-input, input#custom-sum-input {
    font-size: 1.25rem; font-weight: 600; padding: 10px 14px;
    border-radius: 18px; border: 2px solid #a1d578; outline-offset: 3px;
  }
  input#answer-input { width: 120px; text-align: center; }
  input#custom-sum-input { width: 100%; box-sizing: border-box; background: #f4fff3; }

  .action-btn {
    font-family: 'Baloo 2', cursive; font-weight: 900;
    padding: 10px 20px; border: none; border-radius: 18px;
    cursor: pointer; color: white;
  }

  #check-answer { background: linear-gradient(90deg,#fb3f7a, #fc8a96); box-shadow: 0 4px 0 #d42d62; }
  #new-sum { background: linear-gradient(90deg,#4eb87f, #6ad89e); box-shadow: 0 4px 0 #3a8c60; }
  
  #feedback { font-weight: 700; font-size: 1.35rem; min-height: 2.5rem; color: #de1e7e; }

  #num-keyboard {
    margin-top: 12px; display: grid;
    grid-template-columns: repeat(4, 1fr); gap: 10px; width: 100%;
  }

  .num-btn {
    background: #7ecc7a; font-family: 'Baloo 2'; font-weight: 900;
    color: #164813; font-size: 1.5rem; border: none;
    border-radius: 15px; padding: 12px 0; cursor: pointer;
    box-shadow: 0 4px 0 #5e9e5a;
  }

  #confetti-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }

  @media (max-width: 600px) {
    #musikids-player-card { top: auto; bottom: 10px; right: 10px; scale: 0.85; }
    header { font-size: 1.8rem; margin-top: 60px; }
  }
</style>
</head>
<body>

<div id="confetti-wrapper"></div>

<div id="musikids-player-card">
    <span class="player-label">M√∫sica</span>
    <div class="player-controls">
        <button class="player-btn" onclick="playPrev()">‚èÆÔ∏è</button>
        <button class="player-btn" onclick="toggleMusic()" id="play-pause-btn">‚ñ∂Ô∏è</button>
        <button class="player-btn" onclick="playNext()">‚è≠Ô∏è</button>
        <button class="player-btn btn-shuffle" onclick="toggleShuffle()" id="shuffle-btn">üîÄ</button>
    </div>
</div>
<div style="position: absolute; left: -9999px;"><div id="yt-audio-element"></div></div>

<button id="btn-menu" onclick="location.href='../index.html'">MENU</button>

<header>Continhas MusiKids</header>

<main>
  <div id="simple-sum">0 + 0 = ?</div>
  
  <div class="answer-section">
    <input type="text" inputmode="numeric" id="answer-input" placeholder="?" />
    <button id="check-answer" class="action-btn">Verificar</button>
    <button id="new-sum" class="action-btn">Nova Conta</button>
  </div>

  <div id="feedback"></div>

  <div style="width:100%">
    <div style="display:flex; gap:5px; margin-bottom:10px;">
        <input type="text" id="custom-sum-input" placeholder="Ou digite sua conta..." />
        <button id="show-custom-answer-btn" class="action-btn" style="background:#ff9a4c; font-size:0.9rem;">Resposta</button>
    </div>

    <div id="num-keyboard">
      <button class="num-btn" data-val="7">7</button>
      <button class="num-btn" data-val="8">8</button>
      <button class="num-btn" data-val="9">9</button>
      <button class="num-btn" data-val="+">+</button>
      
      <button class="num-btn" data-val="4">4</button>
      <button class="num-btn" data-val="5">5</button>
      <button class="num-btn" data-val="6">6</button>
      <button class="num-btn" data-val="-">‚àí</button>
      
      <button class="num-btn" data-val="1">1</button>
      <button class="num-btn" data-val="2">2</button>
      <button class="num-btn" data-val="3">3</button>
      <button class="num-btn" data-val="*">√ó</button>
      
      <button class="num-btn" id="clear-custom-btn" style="background:#ff968a;">C</button>
      <button class="num-btn" data-val="0">0</button>
      <button class="num-btn" data-val=".">.</button>
      <button class="num-btn" data-val="/">√∑</button>

      <button id="create-sum-btn" class="num-btn" style="grid-column: span 4; background:#5b9fca; color:white;">GERAR CONTA (=)</button>
    </div>
  </div>
</main>

<script src="../../js/musicas_data.js" onerror="console.log('Playlist offline')"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
// --- LOGICA DO PLAYER ---
let playerYT;
let currentIndex = parseInt(sessionStorage.getItem('musi_index')) || 0;
let isShuffle = sessionStorage.getItem('musi_shuffle') === 'true';
const getPlaylist = () => (typeof listaMusicasIds !== 'undefined') ? listaMusicasIds : ['dQw4w9WgXcQ'];

function onYouTubeIframeAPIReady() {
    playerYT = new YT.Player('yt-audio-element', {
        height: '0', width: '0',
        videoId: getPlaylist()[currentIndex],
        playerVars: { 'autoplay': sessionStorage.getItem('musi_playing') === 'true' ? 1 : 0 },
        events: { 
            'onReady': () => { if(isShuffle) document.getElementById('shuffle-btn').classList.add('active'); updatePlayBtn(); },
            'onStateChange': (e) => { if(e.data === 0) playNext(); updatePlayBtn(); } 
        }
    });
}
function updatePlayBtn() { 
    const btn = document.getElementById('play-pause-btn');
    if(btn && playerYT?.getPlayerState) btn.innerText = playerYT.getPlayerState() === 1 ? "‚è∏Ô∏è" : "‚ñ∂Ô∏è";
}
function toggleMusic() { 
    if(!playerYT?.playVideo) return;
    playerYT.getPlayerState() === 1 ? playerYT.pauseVideo() : playerYT.playVideo();
    setTimeout(updatePlayBtn, 200);
}
function playNext() { 
    let list = getPlaylist();
    currentIndex = isShuffle ? Math.floor(Math.random() * list.length) : (currentIndex + 1) % list.length;
    playerYT?.loadVideoById(list[currentIndex]);
    sessionStorage.setItem('musi_index', currentIndex);
}
function playPrev() {
    let list = getPlaylist();
    currentIndex = (currentIndex - 1 + list.length) % list.length;
    playerYT?.loadVideoById(list[currentIndex]);
    sessionStorage.setItem('musi_index', currentIndex);
}
function toggleShuffle() {
    isShuffle = !isShuffle;
    sessionStorage.setItem('musi_shuffle', isShuffle);
    document.getElementById('shuffle-btn').classList.toggle('active');
}

// --- LOGICA DO JOGO ---
const sumDisplay = document.getElementById("simple-sum");
const answerInput = document.getElementById("answer-input");
const feedback = document.getElementById("feedback");
const customInput = document.getElementById("custom-sum-input");

let currentSum = { expected: 0 };

function generateSum() {
    document.getElementById('confetti-wrapper').innerHTML = '';
    const ops = ["+", "-", "*", "/"];
    let op = ops[Math.floor(Math.random() * 4)];
    let n1, n2;
    if (op === "/") { n2 = Math.floor(Math.random() * 9) + 1; n1 = n2 * (Math.floor(Math.random() * 10)); }
    else { n1 = Math.floor(Math.random() * 21); n2 = Math.floor(Math.random() * 21); }
    if (op === "-" && n2 > n1) [n1, n2] = [n2, n1];
    
    const symbol = op === '*' ? '√ó' : op === '/' ? '√∑' : op;
    sumDisplay.textContent = `${n1} ${symbol} ${n2} = ?`;
    
    let result;
    if(op === "+") result = n1 + n2;
    if(op === "-") result = n1 - n2;
    if(op === "*") result = n1 * n2;
    if(op === "/") result = n1 / n2;
    
    currentSum.expected = result;
    answerInput.value = "";
    feedback.textContent = "";
    answerInput.disabled = false;
    answerInput.focus();
}

document.getElementById("check-answer").onclick = () => {
    const val = parseFloat(answerInput.value);
    if (val === currentSum.expected) {
        feedback.textContent = "üåü ACERTOU! PARAB√âNS! üåü";
        lancarConfetes();
        answerInput.disabled = true;
        setTimeout(generateSum, 3000);
    } else {
        feedback.textContent = "Tente de novo! ‚úçÔ∏è";
    }
};

document.getElementById("new-sum").onclick = generateSum;

// Teclado
let lastFocused = answerInput;
answerInput.onfocus = () => lastFocused = answerInput;
customInput.onfocus = () => lastFocused = customInput;

document.querySelectorAll(".num-btn").forEach(btn => {
    btn.onclick = () => {
        const val = btn.getAttribute("data-val");
        if (btn.id === "clear-custom-btn") { lastFocused.value = ""; return; }
        if (btn.id === "create-sum-btn") {
            try {
                const expr = customInput.value.replace(/√ó/g, '*').replace(/√∑/g, '/').replace(/‚àí/g, '-');
                const res = eval(expr);
                sumDisplay.textContent = customInput.value + " = ?";
                currentSum.expected = res;
                answerInput.value = "";
                answerInput.focus();
            } catch(e) { feedback.textContent = "Conta inv√°lida!"; }
            return;
        }
        if (val) {
            const display = val === '*' ? '√ó' : val === '/' ? '√∑' : val;
            lastFocused.value += display;
        }
    };
});

document.getElementById("show-custom-answer-btn").onclick = () => {
    try {
        const expr = customInput.value.replace(/√ó/g, '*').replace(/√∑/g, '/');
        feedback.textContent = "Resposta: " + eval(expr);
    } catch(e) { feedback.textContent = "Erro na conta!"; }
};

function lancarConfetes() {
    const wrapper = document.getElementById('confetti-wrapper');
    const cores = ['#ff71ce', '#01cdfe', '#fdf200', '#7c4dff', '#a1d578'];
    for (let i = 0; i < 50; i++) {
        const c = document.createElement('div');
        c.style.position = 'absolute';
        c.style.width = '10px'; c.style.height = '10px';
        c.style.backgroundColor = cores[Math.floor(Math.random()*cores.length)];
        c.style.left = Math.random() * 100 + 'vw';
        c.style.top = '-10px';
        c.style.borderRadius = '50%';
        c.animate([
            { transform: 'translateY(0) rotate(0)' },
            { transform: `translateY(100vh) rotate(${Math.random()*360}deg)` }
        ], { duration: Math.random()*2000 + 2000, easing: 'linear' });
        wrapper.appendChild(c);
    }
}

generateSum();
</script>
</body>
</html>
