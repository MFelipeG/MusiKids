<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jogo da MemÃ³ria - MusiKids Fun</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Baloo+2&display=swap');

body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
  font-family: 'Baloo 2', cursive, Arial, sans-serif;
  background: linear-gradient(135deg,#f7f4e9,#f8b500,#ff7eb9 100%);
  color: #32434a;
  user-select: none;
  box-sizing: border-box;
  text-align: center;
}

#btn-menu {
  position: fixed;
  top: 15px;
  left: 15px;
  background: #a1d578;
  color: #214d0d;
  border-radius: 18px;
  padding: 14px 22px;
  font-weight: 900;
  font-size: 1.25rem;
  cursor: pointer;
  box-shadow: 0 0 15px #a1d578aa;
  border: none;
  user-select: none;
  z-index: 10000;
  transition: background-color .3s ease;
}

#btn-menu:hover {
  background: #68922b;
  color: white;
}

header {
  margin-top: 75px;
  font-weight: 900;
  font-size: 2.4rem;
  color: #d63a6d;
  user-select: none;
  margin-bottom: 20px;
}

#game-container {
  max-width: 980px;
  margin: 0 auto;
  background: white;
  border-radius: 28px;
  box-shadow: 0 4px 18px #ffd3e466;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#config-container {
  margin-bottom: 20px;
  display: flex;
  gap: 20px;
  justify-content: center;
  flex-wrap: wrap;
}
.select-group {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-weight: 700;
  color: #5e219b;
}
.select-group label {
  margin-bottom: 6px;
}

select {
  font-size: 1rem;
  border-radius: 14px;
  padding: 6px 12px;
  border: 2px solid #d63a6d;
  cursor: pointer;
}

#buttons {
  margin-top: 10px;
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  justify-content: center;
}

button.action-btn {
  background: #a1d578;
  color: #214d0d;
  border-radius: 18px;
  padding: 14px 22px;
  font-weight: 900;
  font-size: 1.15rem;
  cursor: pointer;
  box-shadow: 0 0 15px #a1d578aa;
  border: none;
  user-select: none;
  transition: background-color .3s ease;
  min-width: 140px;
}

button.action-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  box-shadow: none;
}

button.action-btn:hover:not(:disabled) {
  background: #68922b;
  color: white;
}

#cards-grid {
  display: grid;
  gap: 12px;
  justify-content: center;
  margin-top: 15px;
  max-width: 900px;
}

.card {
  width: 70px;
  height: 90px;
  perspective: 800px;
  cursor: pointer;
}

.card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  transition: transform 0.5s;
  transform-style: preserve-3d;
  border-radius: 15px;
  box-shadow: 0 5px 10px rgba(0,0,0,0.2);
}

.card.flipped .card-inner {
  transform: rotateY(180deg);
}

.card-front, .card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 15px;
  backface-visibility: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 40px;
  user-select: none;
}

.card-front {
  background: #f7f7f7;
  box-shadow: 0 0 10px #d63a6d80 inset;
}

.card-back {
  background: #ff7eb9;
  transform: rotateY(180deg);
  box-shadow: 0 0 10px #4a004a inset;
}

.card.matched {
  cursor: default;
  box-shadow: 0 0 15px 3px #7ef5be;
}

#result-text {
  margin-top: 15px;
  font-weight: 700;
  font-size: 1.35rem;
  color: #d63a6d;
  min-height: 36px;
}

#confetti {
  pointer-events: none;
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  z-index: 9999;
  overflow: visible;
}

.confetti-piece {
  pointer-events: none;
  position: fixed;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  animation: fall 3s linear forwards;
  opacity: 1;
}

@keyframes fall {
  0% { transform: translateY(0); opacity: 1;}
  100% { transform: translateY(100vh); opacity: 0;}
}
</style>
</head>
<body>

<button id="btn-menu" aria-label="Voltar ao menu">MENU DE JOGOS</button>
<header>Jogo da MemÃ³ria - MusiKids Fun</header>

<div id="game-container">

  <div id="config-container">
    <div class="select-group">
      <label for="select-categoria">Categoria:</label>
      <select id="select-categoria" aria-label="Selecionar categoria">
        <option value="animais">Animais</option>
        <option value="objetos">Objetos</option>
      </select>
    </div>
    <div class="select-group">
      <label for="select-quantidade">Quantidade de cartas:</label>
      <select id="select-quantidade" aria-label="Selecionar quantidade de cartas">
        <option value="20">20 cartas (10 pares)</option>
        <option value="40" selected>40 cartas (20 pares)</option>
        <option value="60">60 cartas (30 pares)</option>
      </select>
    </div>
  </div>

  <div id="buttons">
    <button id="btn-novo" class="action-btn" aria-label="Iniciar novo jogo">Iniciar Novo Jogo</button>
    <button id="btn-virar" class="action-btn" aria-label="Virar as cartas para trÃ¡s" disabled>Virar Cartas para trÃ¡s</button>
    <button id="btn-espiar" class="action-btn" aria-label="Espiar cartas" disabled>Espiar (3)</button>
  </div>

  <div id="cards-grid" aria-label="Tabuleiro de cartas da memÃ³ria"></div>
  <div id="result-text" aria-live="polite" aria-atomic="true" role="status"></div>
</div>

<div id="confetti"></div>

<script>
const figurasAnimais = [
  "ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ¦Š","ğŸ»","ğŸ¼","ğŸ¦„","ğŸ®",
  "ğŸ·","ğŸ¸","ğŸµ","ğŸ”","ğŸ§","ğŸ¦","ğŸ¦‰","ğŸ´","ğŸ","ğŸ",
  "ğŸ¦‹","ğŸŒ","ğŸ¢","ğŸ","ğŸ¦","ğŸ¦‚","ğŸ¦€","ğŸ ","ğŸ³","ğŸ¬",
  "ğŸ‹","ğŸ¦ˆ","ğŸŠ","ğŸ…","ğŸ†","ğŸ¦“","ğŸ¦","ğŸ¦§","ğŸ˜","ğŸ¦›",
  "ğŸ¦","ğŸª","ğŸ«","ğŸ¦™","ğŸ¦’","ğŸƒ","ğŸ‚","ğŸ„","ğŸ","ğŸ¦Œ",
];

const figurasObjetos = [
  "ğŸˆ","ğŸ","ğŸ€","ğŸ“¦","ğŸ“š","ğŸ–ï¸","âœ‚ï¸","ğŸ–Šï¸","ğŸ–Œï¸","ğŸ”‘",
  "ğŸ“¸","ğŸ“±","ğŸ’»","âŒš","ğŸ¨","ğŸ¸","ğŸ“–","ğŸ’¡","ğŸ”¦","ğŸ§¸",
  "ğŸš—","ğŸš²","â›µ","âœˆï¸","ğŸš€","ğŸ›´","ğŸ€","âš½","ğŸ¾","ğŸ¯",
  "ğŸ®","ğŸ²","ğŸ§©","ğŸ›’","ğŸ§¸","ğŸ¤","ğŸ§","ğŸ“º","ğŸ“»","ğŸ’°",
  "ğŸ””","ğŸ“…","ğŸ“Œ","ğŸ“","ğŸ“","ğŸ–‡ï¸","ğŸ›ï¸","ğŸ›‹ï¸","ğŸšª","ğŸš¿"
];

// Estado do jogo
let cartas = [];
let cartasViradas = [];
let paresEncontrados = 0;
let podeVirar = false;
let espiarContador = 3;
let cartasViradasNoMomento = false;

const btnMenu = document.getElementById('btn-menu');
const btnNovo = document.getElementById('btn-novo');
const btnVirar = document.getElementById('btn-virar');
const btnEspiar = document.getElementById('btn-espiar');
const selectCategoria = document.getElementById('select-categoria');
const selectQuantidade = document.getElementById('select-quantidade');
const cardsGrid = document.getElementById('cards-grid');
const resultText = document.getElementById('result-text');
const confettiContainer = document.getElementById('confetti');

// Configura grid conforme quantidade
function ajustaGrid(quantidade) {
  if(quantidade <= 20) {
    cardsGrid.style.gridTemplateColumns = 'repeat(5, 1fr)';
    cardsGrid.style.maxWidth = '380px';
  } else if(quantidade <= 40) {
    cardsGrid.style.gridTemplateColumns = 'repeat(8, 1fr)';
    cardsGrid.style.maxWidth = '620px';
  } else {
    cardsGrid.style.gridTemplateColumns = 'repeat(10, 1fr)';
    cardsGrid.style.maxWidth = '780px';
  }
}

btnMenu.onclick = () => {
  location.href = '../index.html';
};

function shuffle(arr) {
  return arr.map(i => [Math.random(), i]).sort((a,b) => a[0]-b[0]).map(i=>i[1]);
}

function criaCartas() {
  const categoria = selectCategoria.value;
  const quantidadeCartas = Number(selectQuantidade.value);
  const pares = quantidadeCartas / 2;

  // Seleciona as figuras conforme categoria
  let figuras = categoria === 'animais' ? figurasAnimais : figurasObjetos;
  if(pares > figuras.length) {
    figuras = shuffle(figuras).slice(0, pares);
  } else {
    figuras = figuras.slice(0, pares);
  }

  // Duplicar e embaralhar
  let figurasDuplicadas = [...figuras, ...figuras];
  figurasDuplicadas = shuffle(figurasDuplicadas);

  cartas = [];
  cardsGrid.innerHTML = '';

  figurasDuplicadas.forEach((figura, idx) => {
    const card = document.createElement('div');
    card.className = 'card flipped'; // comeÃ§a virada para frente
    card.dataset.figura = figura;
    card.setAttribute('role', 'button');
    card.setAttribute('tabindex', '0');
    card.innerHTML = `
      <div class="card-inner">
        <div class="card-front">${figura}</div>
        <div class="card-back"></div>
      </div>
    `;
    card.addEventListener('click', () => virarCarta(card));
    cardsGrid.appendChild(card);
    cartas.push(card);
  });

  ajustaGrid(quantidadeCartas);
  paresEncontrados = 0;
  cartasViradas = [];
  espiarContador = 3;
  podeVirar = false;
  cartasViradasNoMomento = false;

  btnVirar.disabled = false;
  btnVirar.textContent = 'Virar Cartas para trÃ¡s';
  btnEspiar.disabled = true;
  updateTexto();
}

function virarCarta(card) {
  if(!podeVirar) return;
  if(cartasViradas.includes(card) || card.classList.contains('matched')) return;
  card.classList.add('flipped');
  cartasViradas.push(card);
  if(cartasViradas.length === 2) {
    podeVirar = false;
    setTimeout(verificaPar, 900);
  }
}

function verificaPar() {
  const [carta1, carta2] = cartasViradas;
  if(carta1.dataset.figura === carta2.dataset.figura) {
    carta1.classList.add('matched');
    carta2.classList.add('matched');
    paresEncontrados++;
    if(paresEncontrados === cartas.length /2) {
      encerraJogo();
    }
  } else {
    carta1.classList.remove('flipped');
    carta2.classList.remove('flipped');
  }
  cartasViradas = [];
  podeVirar = true;
  updateTexto();
}

btnNovo.onclick = () => {
  criaCartas();
};

btnVirar.onclick = () => {
  if (!cartasViradasNoMomento) {
    // Vira todas para trÃ¡s
    cartas.forEach(carta => carta.classList.remove('flipped'));
    podeVirar = true;
    btnVirar.textContent = 'Virar Cartas para frente';
    cartasViradasNoMomento = true;
    btnEspiar.disabled = false;
  } else {
    // Vira todas para frente
    cartas.forEach(carta => carta.classList.add('flipped'));
    podeVirar = false;
    btnVirar.textContent = 'Virar Cartas para trÃ¡s';
    cartasViradasNoMomento = false;
    btnEspiar.disabled = true;
  }
};

btnEspiar.onclick = () => {
  if(espiarContador > 0) {
    // Vira todas para frente temporariamente
    cartas.forEach(carta => carta.classList.add('flipped'));
    btnEspiar.disabled = true;
    espiarContador--;
    updateTexto();
    btnEspiar.textContent = `Espiar (${espiarContador})`;
    setTimeout(() => {
      if(podeVirar) { // Se ainda pode virar
        cartas.forEach(carta => {
          if(!carta.classList.contains('matched')) carta.classList.remove('flipped');
        });
        btnEspiar.disabled = espiarContador === 0;
      }
    }, 2000);
  }
};

function updateTexto() {
  resultText.textContent = `Pares encontrados: ${paresEncontrados} de ${cartas.length / 2}`;
}

function encerraJogo() {
  resultText.textContent = 'ParabÃ©ns! VocÃª encontrou todos os pares!';
  confete();
  btnVirar.disabled = true;
  btnEspiar.disabled = true;
}

function confete() {
  confettiContainer.innerHTML = '';
  const colors = ['#ff597f', '#ff9ea1', '#fcd677', '#a9d97a', '#79d79a', '#ff7eb9', '#61dafb'];
  for(let i=0; i<120; i++){
    const c = document.createElement('div');
    c.className = 'confetti-piece';
    c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
    c.style.top = Math.random()*window.innerHeight + 'px';
    c.style.left = Math.random()*window.innerWidth + 'px';
    c.style.animationDelay = (i*0.015) + 's';
    confettiContainer.appendChild(c);
  }
  setTimeout(() => { confettiContainer.innerHTML = ''; }, 3500);
}

// Inicializa no carregamento
window.onload = () => {
  updateTexto();
  btnVirar.disabled = true;
  btnEspiar.disabled = true;
  cardsGrid.innerHTML = '';
};
</script>

</body>
</html>
