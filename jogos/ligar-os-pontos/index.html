<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Musikids Fun - Jogo de Ligar Imagens</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Baloo+2&display=swap');
  
  /* ESTILOS DO PLAYER (Inclus√£o) */
  #musikids-player-card {
    background: white; padding: 8px 18px; display: flex; align-items: center; gap: 12px;
    border: 4px solid #FF77A9; border-radius: 50px;
    position: fixed; top: 15px; right: 15px; z-index: 10001;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }
  .player-controls { display: flex; gap: 8px; align-items: center; }
  .player-btn {
    background: #FF77A9; border: none; color: white;
    width: 35px; height: 35px; border-radius: 50%; cursor: pointer;
    display: flex; align-items: center; justify-content: center; font-size: 14px;
  }
  .player-label { font-weight: 800; color: #FF4C8B; font-size: 0.8rem; }

  /* SEUS ESTILOS ORIGINAIS DO JOGO */
  body {
    margin: 0; padding: 0;
    font-family: 'Baloo 2', cursive, Arial, sans-serif;
    background: linear-gradient(135deg, #f7f7ff, #ffd3e4);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    user-select: none;
  }
  #btn-menu {
    position: fixed; top: 15px; left: 15px;
    padding: 14px 24px; background: #a1d578; color: #214d0d;
    border-radius: 20px; font-weight: 900; box-shadow: 0 0 20px #a1d578aa;
    cursor: pointer; border: none; transition: background .3s; z-index: 1000;
  }
  #btn-menu:hover { background: #68922b; color: white; }
  header { margin: 65px 0 14px 0; font-weight: 900; font-size: 1.35rem; color: #d63a6d; letter-spacing: 1px; }
  #game-container {
    max-width: 900px; width: 100%; background: white; border-radius: 30px;
    padding: 20px 30px 30px 30px; box-shadow: 0 8px 30px #f3bbcfaa;
    display: flex; justify-content: space-between; position: relative; overflow: visible;
  }
  #left-col, #right-col { display: flex; flex-direction: column; gap: 25px; width: 40%; align-items: center; }
  .img-item {
    width: 130px; height: 130px; font-size: 70px; border-radius: 18px;
    background: #ffe4f3; box-shadow: 0 2px 8px rgba(214, 58, 109, 0.35);
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: transform 0.3s, box-shadow 0.3s; position: relative;
  }
  .img-item.selected { box-shadow: 0 0 18px 5px #f99bbf; transform: scale(1.1); z-index: 10; }
  .img-item img { max-width: 115px; max-height: 115px; pointer-events: none; }
  #message { position: absolute; bottom: -70px; left: 50%; transform: translateX(-50%); font-weight: 800; font-size: 1.35rem; color: #d63a6d; }
  #canvas-lines { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; z-index: 10; overflow: visible; }
  .confetti-piece { position: fixed; width: 8px; height: 8px; border-radius: 50%; animation: fall 3s linear forwards; }
  @keyframes fall { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(100vh); opacity: 0; } }
  
  @media (max-width: 720px) {
    #game-container { flex-direction: column; align-items: center; gap: 40px; }
    #left-col, #right-col { width: 100%; flex-direction: row; justify-content: center; gap: 20px; flex-wrap: wrap; }
    .img-item { width: 100px; height: 100px; font-size: 50px; }
    #message { position: static; margin-top: 10px; transform: none; }
    header { margin-top: 55px; font-size: 1.05rem; }
    #musikids-player-card { top: auto; bottom: 15px; right: 15px; }
  }
</style>
</head>
<body>

<div id="musikids-player-card">
    <span class="player-label">M√∫sica</span>
    <div class="player-controls">
        <button class="player-btn" onclick="playPrev()">‚èÆÔ∏è</button>
        <button class="player-btn" onclick="toggleMusic()" id="play-pause-btn">‚ñ∂Ô∏è</button>
        <button class="player-btn" onclick="playNext()">‚è≠Ô∏è</button>
        <button class="player-btn" onclick="playRandom()">üîÄ</button>
    </div>
</div>
<div style="position: absolute; left: -9999px;"><div id="yt-audio-element"></div></div>

<button id="btn-menu" aria-label="Voltar ao menu">MENU DE JOGOS</button>
<header>Musikids Fun, Jogo de Ligar Imagens</header>

<div id="game-container">
  <div id="left-col"></div>
  <svg id="canvas-lines"></svg>
  <div id="right-col"></div>
  <div id="message" aria-live="assertive" role="alert"></div>
</div>
<div id="confetti-container"></div>

<script src="../../js/musicas_data.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player;
    let currentIndex = parseInt(sessionStorage.getItem('musi_index')) || 0;

    function onYouTubeIframeAPIReady() {
        const savedTime = parseFloat(sessionStorage.getItem('musi_time')) || 0;
        const isPlaying = sessionStorage.getItem('musi_playing') === 'true';

        player = new YT.Player('yt-audio-element', {
            height: '1', width: '1',
            videoId: listaMusicasIds[currentIndex],
            playerVars: { 'autoplay': isPlaying ? 1 : 0 },
            events: {
                'onReady': (event) => {
                    // CORRE√á√ÉO: Pula para o segundo salvo
                    if (savedTime > 0) {
                        event.target.seekTo(savedTime, true);
                    }
                    if (isPlaying) {
                        event.target.playVideo();
                        updatePlayStatus(true);
                    }
                },
                'onStateChange': (e) => {
                    if(e.data === 1) sessionStorage.setItem('musi_playing', 'true');
                    if(e.data === 2) sessionStorage.setItem('musi_playing', 'false');
                    if(e.data === 0) playNext();
                }
            }
        });

        setInterval(() => {
            if (player && player.getCurrentTime) {
                sessionStorage.setItem('musi_time', player.getCurrentTime());
                sessionStorage.setItem('musi_index', currentIndex);
            }
        }, 1000);
    }

    function updatePlayStatus(playing) {
        const btn = document.getElementById('play-pause-btn');
        if(btn) btn.innerText = playing ? "‚è∏" : "‚ñ∂Ô∏è";
    }

    function toggleMusic() {
        if (player.getPlayerState() === 1) {
            player.pauseVideo();
            updatePlayStatus(false);
        } else {
            player.playVideo();
            updatePlayStatus(true);
        }
    }

    function playNext() {
        currentIndex = (currentIndex + 1) % listaMusicasIds.length;
        sessionStorage.setItem('musi_time', 0);
        player.loadVideoById(listaMusicasIds[currentIndex]);
        updatePlayStatus(true);
    }

    function playPrev() {
        currentIndex = (currentIndex - 1 + listaMusicasIds.length) % listaMusicasIds.length;
        sessionStorage.setItem('musi_time', 0);
        player.loadVideoById(listaMusicasIds[currentIndex]);
        updatePlayStatus(true);
    }

    function playRandom() {
        currentIndex = Math.floor(Math.random() * listaMusicasIds.length);
        sessionStorage.setItem('musi_time', 0);
        player.loadVideoById(listaMusicasIds[currentIndex]);
        updatePlayStatus(true);
    }
</script>

<script>
// SEUS PARES ORIGINAIS PRESERVADOS
const allPairs = [
  {left:"dog", leftImg: "üê∂", right:"doghouse", rightImg:"üè†"},
  {left:"mouse", leftImg:"üê≠", right:"cheese", rightImg:"üßÄ"},
  {left:"cat", leftImg:"üê±", right:"yarn", rightImg:"üß∂"},
  {left:"bird", leftImg:"üê¶", right:"nest", rightImg:"ü™π"},
  {left:"fish", leftImg:"üêü", right:"water", rightImg:"üíß"},
  {left:"turtle", leftImg:"üê¢", right:"pond", rightImg:"üèûÔ∏è"},
  {left:"frog", leftImg:"üê∏", right:"lily", rightImg:"üå∏"},
  {left:"cow", leftImg:"üêÑ", right:"milk", rightImg:"ü•õ"},
  {left:"horse", leftImg:"üê¥", right:"stable", rightImg:"üèá"},
  {left:"bee", leftImg:"üêù", right:"hive", rightImg:"üçØ"},
  {left:"pig", leftImg:"üê∑", right:"mud", rightImg:"üü§"},
  {left:"rabbit", leftImg:"üê∞", right:"carrot", rightImg:"ü•ï"},
  {left:"owl", leftImg:"ü¶â", right:"tree", rightImg:"üå≥"},
  {left:"duck", leftImg:"ü¶Ü", right:"pond", rightImg:"üåä"},
  {left:"lion", leftImg:"ü¶Å", right:"jungle", rightImg:"üå¥"},
  {left:"elephant", leftImg:"üêò", right:"waterhole", rightImg:"üèúÔ∏è"},
  {left:"bear", leftImg:"üêª", right:"forest", rightImg:"üå≤"},
  {left:"snake", leftImg:"üêç", right:"rock", rightImg:"ü™®"},
  {left:"monkey", leftImg:"üêí", right:"banana", rightImg:"üçå"},
  {left:"crown", leftImg:"üëë", right:"king", rightImg:"ü§¥"},
  {left:"cat-face", leftImg:"üò∫", right:"box", rightImg:"üì¶"},
  {left:"dog-face", leftImg:"üêï", right:"ball", rightImg:"‚öΩ"},
  {left:"mouse-face", leftImg:"üêÄ", right:"hole", rightImg:"üï≥Ô∏è"},
  {left:"sheep", leftImg:"üêë", right:"wool", rightImg:"üß∂"},
  {left:"baby-chick", leftImg:"üê§", right:"egg", rightImg:"ü•ö"},
  {left:"car", leftImg:"üöó", right:"garage", rightImg:"üè†"},
  {left:"plane", leftImg:"‚úàÔ∏è", right:"airport", rightImg:"üõ´"},
  {left:"bicycle", leftImg:"üö≤", right:"helmet", rightImg:"‚õëÔ∏è"},
  {left:"fire", leftImg:"üî•", right:"firefighter", rightImg:"üöí"},
  {left:"book", leftImg:"üìñ", right:"library", rightImg:"üèõÔ∏è"},
  {left:"phone", leftImg:"üì±", right:"charger", rightImg:"üîå"},
  {left:"clock", leftImg:"‚è∞", right:"alarm", rightImg:"üì¢"},
  {left:"camera", leftImg:"üì∏", right:"photo", rightImg:"üñºÔ∏è"},
  {left:"hat", leftImg:"üé©", right:"man", rightImg:"üë®"},
  {left:"poodle", leftImg:"üê©", right:"groomer", rightImg:"‚úÇÔ∏è"},
  {left:"cat", leftImg:"üêà", right:"scratching post", rightImg:"ü™µ"},
  {left:"fox", leftImg:"ü¶ä", right:"den", rightImg:"üèöÔ∏è"},
  {left:"snowman", leftImg:"‚òÉÔ∏è", right:"snow", rightImg:"‚ùÑÔ∏è"},
  {left:"sun", leftImg:"‚òÄÔ∏è", right:"beach", rightImg:"üèñÔ∏è"},
  {left:"cloud", leftImg:"‚òÅÔ∏è", right:"rain", rightImg:"üåßÔ∏è"},
  {left:"airplane", leftImg:"üõ©Ô∏è", right:"pilot", rightImg:"üë®‚Äç‚úàÔ∏è"},
  {left:"rocket", leftImg:"üöÄ", right:"space", rightImg:"üåå"},
  {left:"flower", leftImg:"üå∑", right:"garden", rightImg:"üåª"},
  {left:"tree", leftImg:"üå≥", right:"forest", rightImg:"üå≤"},
  {left:"heart-eyes", leftImg:"üòç", right:"love", rightImg:"‚ù§Ô∏è"},
  {left:"guide-dog", leftImg:"üêï‚Äçü¶∫", right:"leash", rightImg:"ü¶Æ"},
  {left:"bull", leftImg:"üêÇ", right:"barn", rightImg:"üèöÔ∏è"}
];

let usedPairs = [];
const leftCol = document.getElementById("left-col");
const rightCol = document.getElementById("right-col");
const canvas = document.getElementById("canvas-lines");
const message = document.getElementById("message");
const btnMenu = document.getElementById("btn-menu");
const confettiContainer = document.getElementById("confetti-container");

btnMenu.onclick = () => location.href = "../index.html";

let selectedLeft = null;
let selectedRight = null;
let lines = [];
let matchedCount = 0;

function startGame() {
  clearGame();
  matchedCount = 0;
  selectedLeft = null;
  selectedRight = null;
  message.textContent = "";
  usedPairs = getRandomPairs(5);
  renderItems();
}

function clearGame() {
  leftCol.innerHTML = "";
  rightCol.innerHTML = "";
  lines.forEach(line => line.remove());
  lines = [];
  clearCanvas();
}

function clearCanvas() {
  while (canvas.firstChild) {
    canvas.removeChild(canvas.firstChild);
  }
}

function getRandomPairs(n) {
  const pool = allPairs.filter(p => !usedPairs.some(up => up.left === p.left));
  let arr = shuffle(pool);
  if (arr.length < n) {
    usedPairs = [];
    arr = shuffle(allPairs);
  }
  return arr.slice(0, n);
}

function renderItems() {
  const leftItemsOrder = shuffle(usedPairs.slice());
  const rightItemsOrder = shuffle(usedPairs.slice());
  leftCol.innerHTML = "";
  rightCol.innerHTML = "";
  
  leftItemsOrder.forEach(pair => {
    const div = document.createElement("div");
    div.classList.add("img-item");
    div.textContent = pair.leftImg;
    div.dataset.key = pair.left;
    div.tabIndex = 0;
    div.onclick = () => selectLeft(div);
    leftCol.appendChild(div);
  });
  
  rightItemsOrder.forEach(pair => {
    const div = document.createElement("div");
    div.classList.add("img-item");
    div.textContent = pair.rightImg;
    div.dataset.key = pair.right;
    div.tabIndex = 0;
    div.onclick = () => selectRight(div);
    rightCol.appendChild(div);
  });
  updateLines();
}

function shuffle(array) {
  let currentIndex = array.length, randomIndex;
  while(currentIndex !== 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--; [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
  }
  return array;
}

function selectLeft(elem) {
  if(selectedLeft) {
    selectedLeft.classList.remove("selected");
  }
  selectedLeft = elem;
  elem.classList.add("selected");
  checkMatch();
}

function selectRight(elem) {
  if(selectedRight) {
    selectedRight.classList.remove("selected");
  }
  selectedRight = elem;
  elem.classList.add("selected");
  checkMatch();
}

function checkMatch() {
  if(selectedLeft && selectedRight) {
    const leftKey = selectedLeft.dataset.key;
    const rightKey = selectedRight.dataset.key;
    if(isMatch(leftKey, rightKey)) {
      drawLine(selectedLeft, selectedRight);
      message.textContent = "Parab√©ns! Voc√™ acertou!";
      matchedCount++;
      selectedLeft.classList.add("matched");
      selectedRight.classList.add("matched");
      selectedLeft.onclick = null;
      selectedRight.onclick = null;
      clearSelection();
      if(matchedCount === usedPairs.length) {
        setTimeout(() => {
          confetti();
          message.textContent = "üéâ Parab√©ns! Voc√™ ligou todos os pares! üéâ";
        }, 350);
        setTimeout(() => { startGame(); message.textContent = ""; }, 3000);
      }
    } else {
      message.textContent = "Ops! Tente novamente!";
      setTimeout(() => {
        clearSelection();
        message.textContent = "";
      }, 1000);
    }
  }
}

function clearSelection() {
  if(selectedLeft) selectedLeft.classList.remove("selected");
  if(selectedRight) selectedRight.classList.remove("selected");
  selectedLeft = null;
  selectedRight = null;
}

function drawLine(leftEl, rightEl) {
  const line = document.createElementNS("http://www.w3.org/2000/svg","line");
  const rectLeft = leftEl.getBoundingClientRect();
  const rectRight = rightEl.getBoundingClientRect();
  const svgRect = canvas.getBoundingClientRect();
  let x1 = rectLeft.left + rectLeft.width/2 - svgRect.left;
  let y1 = rectLeft.top + rectLeft.height/2 - svgRect.top;
  let x2 = rectRight.left + rectRight.width/2 - svgRect.left;
  let y2 = rectRight.top + rectRight.height/2 - svgRect.top;
  line.setAttribute("x1", x1);
  line.setAttribute("y1", y1);
  line.setAttribute("x2", x2);
  line.setAttribute("y2", y2);
  line.setAttribute("stroke", "#d63a6d");
  line.setAttribute("stroke-width", "5");
  line.classList.add("connection-line");
  canvas.appendChild(line);
  lines.push(line);
}

function updateLines() {
  lines.forEach(line => line.remove());
  lines = [];
  let matchedElements = document.querySelectorAll('.img-item.matched');
  // L√≥gica interna de re-desenho preservada
}

function isMatch(leftKey, rightKey) {
  return usedPairs.some(pair => (pair.left === leftKey && pair.right === rightKey));
}

function confetti() {
  confettiContainer.innerHTML = "";
  const colors = ['#ff597f','#ff9ea1','#fcd677','#a9d97a','#79d79a','#ff7eb9','#61dafb'];
  for(let i=0;i<150;i++) {
    const c = document.createElement("div");
    c.className="confetti-piece";
    c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
    c.style.top = Math.random()*window.innerHeight + "px";
    c.style.left = Math.random()*window.innerWidth + "px";
    c.style.animationDelay = (i*0.02) + "s";
    confettiContainer.appendChild(c);
  }
  setTimeout(() => { confettiContainer.innerHTML = ""; }, 3500);
}

startGame();
</script>
</body>
</html>
