<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Geometria Kids Fun</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Luckiest+Guy&display=swap');

body {
  margin: 0; padding: 0; min-height: 100vh;
  font-family: 'Baloo 2', cursive;
  background: linear-gradient(135deg, #f7f4e9, #f8b500, #ff71ce 100%);
  display: flex; flex-direction: column; align-items: center;
  overflow-x: hidden;
}

/* --- PLAYER MUSIKIDS --- */
#musikids-player-card {
  background: white; padding: 6px 15px; display: flex; align-items: center; gap: 10px;
  border: 3px solid #FF77A9; border-radius: 50px; position: fixed; top: 10px; right: 10px; 
  z-index: 10001; box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}
.player-controls { display: flex; gap: 6px; align-items: center; }
.player-btn {
  background: #FF77A9; border: none; color: white; width: 30px; height: 30px; 
  border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
  font-size: 14px;
}
.player-label { font-weight: 800; color: #FF4C8B; font-size: 0.8rem; }
.btn-shuffle.active { background: #21a7ff !important; }

#btn-menu {
  position: fixed; top: 10px; left: 10px; background: #7c4dff; color: white;
  border-radius: 15px; padding: 8px 15px; font-weight: 900; border: none; z-index: 10000;
  cursor: pointer; box-shadow: 0 4px 0 #4b2cb3;
}

.header-area { margin-top: 80px; text-align: center; }
.site-title { font-family: 'Luckiest Guy'; font-size: 2.5rem; color: white; text-shadow: 3px 3px 0 #ff71ce; margin: 0; }

#game-container {
  width: 90%; max-width: 600px; background: rgba(255,255,255,0.9); border-radius: 30px;
  padding: 20px; margin: 20px auto; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
  display: block !important; position: relative;
}

.row { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px 0; min-height: 100px; }

.shape-draggable, .drop-zone {
  width: 85px; height: 85px; border-radius: 18px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}

.shape-draggable { background: white; cursor: grab; box-shadow: 0 5px 0 #ddd; transition: 0.2s; }
.shape-draggable.selected { border: 3px solid #7c4dff; transform: scale(1.05); }

.drop-zone { border: 3px dashed #bbb; background: rgba(0,0,0,0.03); position: relative; }
.drop-zone.correct { border-style: solid; border-color: #a1d578; background: #f0fff0; }

.shape-svg { width: 55px; height: 55px; pointer-events: none; }
.shape-label { font-size: 11px; font-weight: bold; color: #444; margin-top: 4px; }

#result-text { font-size: 1.4rem; font-weight: 800; color: #d63a6d; margin: 15px; height: 35px; }

/* --- CONFETES --- */
#confetti-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
.confetti { position: absolute; width: 10px; height: 10px; animation: fall linear forwards; }
@keyframes fall { to { transform: translateY(105vh) rotate(360deg); } }

@media (max-width: 600px) {
  #musikids-player-card { top: auto; bottom: 10px; right: 10px; scale: 0.85; }
  .site-title { font-size: 2rem; }
}
</style>
</head>
<body>

<div id="confetti-wrapper"></div>

<div id="musikids-player-card">
    <span class="player-label">M√∫sica</span>
    <div class="player-controls">
        <button class="player-btn" onclick="playPrev()">‚èÆÔ∏è</button>
        <button class="player-btn" onclick="toggleMusic()" id="play-pause-btn">‚ñ∂Ô∏è</button>
        <button class="player-btn" onclick="playNext()">‚è≠Ô∏è</button>
        <button class="player-btn btn-shuffle" onclick="toggleShuffle()" id="shuffle-btn">üîÄ</button>
    </div>
</div>
<div style="position: absolute; left: -9999px;"><div id="yt-audio-element"></div></div>

<button id="btn-menu" onclick="window.location.href='../index.html'">‚Üê MENU</button>

<div class="header-area">
  <h1 class="site-title">Geometria Kids</h1>
  <p style="color:#595bc3; font-weight:bold; background:white; display:inline-block; padding:2px 12px; border-radius:15px;">Encaixe as formas! üåü</p>
</div>

<div id="game-container">
  <div id="shapes-row" class="row"></div>
  <div id="drop-row" class="row"></div>
  <div id="result-text"></div>
</div>

<script src="../../js/musicas_data.js" onerror="console.log('Playlist n√£o encontrada')"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
// --- PLAYER LOGIC ---
let playerYT;
let currentIndex = parseInt(sessionStorage.getItem('musi_index')) || 0;
let isShuffle = sessionStorage.getItem('musi_shuffle') === 'true';
const getPlaylist = () => (typeof listaMusicasIds !== 'undefined') ? listaMusicasIds : ['dQw4w9WgXcQ'];

function onYouTubeIframeAPIReady() {
    playerYT = new YT.Player('yt-audio-element', {
        height: '0', width: '0',
        videoId: getPlaylist()[currentIndex],
        playerVars: { 'autoplay': sessionStorage.getItem('musi_playing') === 'true' ? 1 : 0 },
        events: { 
            'onReady': () => { if(isShuffle) document.getElementById('shuffle-btn').classList.add('active'); updatePlayBtn(); },
            'onStateChange': (e) => { if(e.data === 0) playNext(); updatePlayBtn(); } 
        }
    });
}
function updatePlayBtn() { 
    const btn = document.getElementById('play-pause-btn');
    if(btn && playerYT?.getPlayerState) btn.innerText = playerYT.getPlayerState() === 1 ? "‚è∏Ô∏è" : "‚ñ∂Ô∏è";
}
function toggleMusic() { 
    if(!playerYT?.playVideo) return;
    playerYT.getPlayerState() === 1 ? playerYT.pauseVideo() : playerYT.playVideo();
    sessionStorage.setItem('musi_playing', playerYT.getPlayerState() !== 1);
    setTimeout(updatePlayBtn, 200);
}
function playNext() { 
    let list = getPlaylist();
    currentIndex = isShuffle ? Math.floor(Math.random() * list.length) : (currentIndex + 1) % list.length;
    playerYT?.loadVideoById(list[currentIndex]);
    sessionStorage.setItem('musi_index', currentIndex);
}
function playPrev() {
    let list = getPlaylist();
    currentIndex = (currentIndex - 1 + list.length) % list.length;
    playerYT?.loadVideoById(list[currentIndex]);
    sessionStorage.setItem('musi_index', currentIndex);
}
function toggleShuffle() {
    isShuffle = !isShuffle;
    sessionStorage.setItem('musi_shuffle', isShuffle);
    document.getElementById('shuffle-btn').classList.toggle('active');
}

// --- JOGO ---
const formas = [
  { id: 'q', n: 'Quadrado', c: '#ff6b6b', s: '<rect x="10" y="10" width="54" height="54" rx="8"/>' },
  { id: 'c', n: 'C√≠rculo', c: '#4ecdc4', s: '<circle cx="37" cy="37" r="30"/>' },
  { id: 't', n: 'Tri√¢ngulo', c: '#45b7d1', s: '<polygon points="37,10 10,65 64,65"/>' },
  { id: 'r', n: 'Ret√¢ngulo', c: '#96ceb4', s: '<rect x="5" y="20" width="64" height="34" rx="8"/>' },
  { id: 's', n: 'Estrela', c: '#feca57', s: '<polygon points="37,5 46,30 72,30 51,46 59,71 37,56 15,71 23,46 2,30 28,30"/>' }
];

let selecionado = null;

function iniciar() {
  // Limpa confetes ao recome√ßar
  document.getElementById('confetti-wrapper').innerHTML = '';
  
  const baralhar = (a) => a.sort(() => Math.random() - 0.5);
  const atual = baralhar([...formas]).slice(0, 4);
  
  const sRow = document.getElementById('shapes-row');
  const dRow = document.getElementById('drop-row');
  sRow.innerHTML = ''; dRow.innerHTML = '';
  document.getElementById('result-text').textContent = "Vamos come√ßar!";

  atual.sort(() => Math.random() - 0.5).forEach(f => {
    const el = document.createElement('div');
    el.className = 'shape-draggable';
    el.draggable = true;
    el.innerHTML = `<svg class="shape-svg" viewBox="0 0 74 74" fill="${f.c}">${f.s}</svg><div class="shape-label">${f.n}</div>`;
    el.onclick = () => {
      document.querySelectorAll('.shape-draggable').forEach(x => x.classList.remove('selected'));
      selecionado = { id: f.id, div: el, html: el.innerHTML };
      el.classList.add('selected');
    };
    el.ondragstart = (e) => { selecionado = { id: f.id, div: el, html: el.innerHTML }; e.dataTransfer.setData('text', f.id); };
    sRow.appendChild(el);
  });

  atual.sort(() => Math.random() - 0.5).forEach(f => {
    const el = document.createElement('div');
    el.className = 'drop-zone';
    el.innerHTML = `<svg class="shape-svg" viewBox="0 0 74 74" fill="${f.c}" opacity="0.2">${f.s}</svg>`;
    el.onclick = () => { if(selecionado) checar(selecionado.id, f.id, el); };
    el.ondragover = (e) => e.preventDefault();
    el.ondrop = (e) => { e.preventDefault(); checar(e.dataTransfer.getData('text'), f.id, el); };
    dRow.appendChild(el);
  });
}

function checar(dragId, dropId, zone) {
  if (dragId === dropId && !zone.classList.contains('correct')) {
    zone.classList.add('correct');
    zone.innerHTML = selecionado.html;
    selecionado.div.style.visibility = 'hidden';
    selecionado = null;
    if (document.querySelectorAll('.drop-zone.correct').length === 4) {
      document.getElementById('result-text').textContent = "üåü VOC√ä CONSEGUIU! üåü";
      lancarConfetes();
      setTimeout(iniciar, 2000); // RECOME√áO EM 2 SEGUNDOS
    }
  }
}

function lancarConfetes() {
  const wrapper = document.getElementById('confetti-wrapper');
  const cores = ['#ff71ce', '#01cdfe', '#fdf200', '#7c4dff', '#a1d578'];
  for (let i = 0; i < 60; i++) {
    const c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random() * 100 + 'vw';
    c.style.backgroundColor = cores[Math.floor(Math.random() * cores.length)];
    c.style.animationDuration = (Math.random() * 2 + 1) + 's';
    c.style.opacity = Math.random();
    wrapper.appendChild(c);
  }
}

iniciar();
</script>
</body>
</html>
