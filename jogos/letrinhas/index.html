<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Jogo das Letrinhas - MusiKids Fun</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700;800&display=swap');

    body {
      font-family: 'Baloo 2', Arial, cursive, sans-serif;
      text-align: center;
      margin: 0;
      padding: 1.5rem 0 .3rem 0;
      background: linear-gradient(135deg,#f7f4e9,#f8b500,#ff7eb9 100%);
      min-height: 100vh;
      color: #32434a;
      overflow: hidden;
    }

    /* --- PLAYER PADR√ÉO MARAVILHOSO --- */
    #musikids-player-card {
      background: white; padding: 8px 18px; display: flex; align-items: center; gap: 12px;
      border: 4px solid #FF77A9; border-radius: 50px; position: fixed; top: 15px; right: 15px; 
      z-index: 10001; box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .player-controls { display: flex; gap: 8px; align-items: center; }
    .player-btn {
      background: #FF77A9; border: none; color: white; width: 35px; height: 35px; 
      border-radius: 50%; cursor: pointer; display: flex; align-items: center; 
      justify-content: center; font-size: 14px;
    }
    .player-label { font-weight: 800; color: #FF4C8B; font-size: 0.9rem; margin-right: 2px; }
    .btn-shuffle.active { background: #21a7ff !important; }

    /* --- BOT√ÉO VOLTAR --- */
    #btn-menu {
      position: fixed; top: 12px; left: 12px; z-index: 1000;
      padding: 10px 20px; font-size: 1.1rem; border-radius: 9px; border: none;
      background: linear-gradient(135deg, #ff007f, #21a7ff 110%);
      color: #fff; font-family: 'Baloo 2', cursive; font-weight: bold;
      box-shadow: 1px 3px 15px #21a7ff99; cursor: pointer; text-decoration: none;
    }

    header { margin-top: 75px; font-weight: 900; font-size: 2.3rem; color: #d63a6d; margin-bottom: 10px; }

    .menu { margin-bottom: 15px; display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
    .menu button {
      padding: 8px 15px; font-size: 14px; border: none; border-radius: 15px;
      font-weight: bold; background: #a1d578; color: #214d0d; cursor: pointer;
    }
    .menu button.active { background: #d63a6d; color: white; border: 2px solid white; }

    .game-container {
      padding: 15px; border-radius: 28px; margin: 0 auto; max-width: 90%;
      background: rgba(255, 255, 255, 0.94); box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      display: inline-block; position: relative; z-index: 10;
    }

    #wordToCopy { font-size: 32px; margin: 5px 0; font-weight: 900; color: #d63a6d; text-transform: uppercase; letter-spacing: 3px; }

    #letterBank, #dropZone { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin: 15px 0; min-height: 55px; }

    .letter {
      padding: 10px 14px; background: #ffe082; border: 3px solid #ff71ce;
      border-radius: 12px; font-size: 20px; font-weight: 800; cursor: pointer;
      box-shadow: 0 4px 0 #ff71ce; transition: all 0.1s;
    }
    .letter:active { transform: translateY(3px); box-shadow: none; }

    .dropSlot {
      min-width: 45px; height: 50px; border: 3px dashed #01cdfe; border-radius: 10px;
      display: flex; align-items: center; justify-content: center; font-size: 22px;
      font-weight: 800; background: #fff; cursor: pointer; padding: 0 5px;
    }
    .dropSlot.filled { border: 3px solid #4CAF50; background: #e8f5e9; color: #2e7d32; }

    .btn-check {
      background: #a1d578; color: #214d0d; padding: 12px 30px;
      font-size: 18px; border-radius: 50px; border: none; font-weight: 900;
      cursor: pointer; margin-top: 5px;
    }

    #message { margin-top: 10px; font-size: 24px; font-weight: 800; min-height: 35px; color: #d63a6d; }

    canvas#confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; }

    @media (max-width: 700px) {
      #musikids-player-card { top: auto; bottom: 15px; right: 10px; scale: 0.8; }
      header { margin-top: 80px; font-size: 1.6rem; }
      .dropSlot { min-width: 35px; height: 45px; font-size: 18px; }
    }
  </style>
</head>
<body>

<div id="musikids-player-card">
    <span class="player-label">M√∫sica</span>
    <div class="player-controls">
        <button class="player-btn" onclick="playPrev()">‚èÆÔ∏è</button>
        <button class="player-btn" onclick="toggleMusic()" id="play-pause-btn">‚ñ∂Ô∏è</button>
        <button class="player-btn" onclick="playNext()">‚è≠Ô∏è</button>
        <button class="player-btn btn-shuffle" onclick="toggleShuffle()" id="shuffle-btn">üîÄ</button>
    </div>
</div>
<div style="position: absolute; left: -9999px;"><div id="yt-audio-element"></div></div>

<a href="../index.html" id="btn-menu">‚Üê Menu</a>
<header>Jogo das Letrinhas</header>

<div class="menu">
  <button id="cat-animais" onclick="changeCategory('animais')">Animais üê∂</button>
  <button id="cat-frutas" onclick="changeCategory('frutas')">Frutas üçé</button>
  <button id="cat-objetos" onclick="changeCategory('objetos')">Objetos üß∏</button>
</div>

<div class="game-container">
  <p id="wordToCopy">...</p>
  <div id="dropZone"></div>
  <div id="letterBank"></div>
  <button class="btn-check" onclick="checkWord()">Verificar! ‚úÖ</button>
  <p id="message"></p>
</div>

<canvas id="confettiCanvas"></canvas>

<script src="../../js/musicas_data.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script>
    // Configura√ß√µes do Player
    let player;
    let currentIndex = parseInt(sessionStorage.getItem('musi_index')) || 0;
    let isShuffle = sessionStorage.getItem('musi_shuffle') === 'true';

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('yt-audio-element', {
            height: '0', width: '0',
            videoId: listaMusicasIds[currentIndex],
            playerVars: { 'autoplay': sessionStorage.getItem('musi_playing') === 'true' ? 1 : 0 },
            events: {
                'onReady': (e) => {
                    const savedTime = parseFloat(sessionStorage.getItem('musi_time')) || 0;
                    if(savedTime > 0) e.target.seekTo(savedTime, true);
                    if(isShuffle) document.getElementById('shuffle-btn').classList.add('active');
                    updatePlayBtn();
                },
                'onStateChange': (e) => { if(e.data === 0) playNext(); updatePlayBtn(); }
            }
        });
    }
    function updatePlayBtn() { const btn = document.getElementById('play-pause-btn'); if(btn && player && player.getPlayerState) btn.innerText = player.getPlayerState() === 1 ? "‚è∏Ô∏è" : "‚ñ∂Ô∏è"; }
    function toggleMusic() { player.getPlayerState() === 1 ? player.pauseVideo() : player.playVideo(); setTimeout(updatePlayBtn, 200); }
    function playNext() { currentIndex = isShuffle ? Math.floor(Math.random() * listaMusicasIds.length) : (currentIndex + 1) % listaMusicasIds.length; player.loadVideoById(listaMusicasIds[currentIndex]); sessionStorage.setItem('musi_index', currentIndex); }
    function playPrev() { currentIndex = (currentIndex - 1 + listaMusicasIds.length) % listaMusicasIds.length; player.loadVideoById(listaMusicasIds[currentIndex]); sessionStorage.setItem('musi_index', currentIndex); }
    function toggleShuffle() { isShuffle = !isShuffle; sessionStorage.setItem('musi_shuffle', isShuffle); document.getElementById('shuffle-btn').classList.toggle('active'); }

    // --- L√ìGICA DO JOGO ---
    const wordsData = {
      animais: ["GATO", "LEAO", "ZEBRA", "URSO", "PATO", "VACA", "PORCO", "SAPO", "COELHO", "TIGRE", "GIRAFA", "MACACO", "COBRA", "PEIXE", "ABELHA", "OVELHA", "CAVALO", "RATINHO", "JACARE", "PANDA", "BALEIA", "PERU", "GALO", "POLVO", "RAPOSA"],
      frutas: ["MACA", "UVA", "PERA", "COCO", "MANGA", "LIMAO", "KIWI", "BANANA", "MELAO", "AMORA", "CAJU", "FIGO", "GOIABA", "JACA", "MAMAO", "ROM√É", "TOMATE", "AMEIXA", "CEREJA", "MANGA", "CACAU", "ABACATE", "MORANGO", "ABACAXI", "PITAYA"],
      objetos: ["MESA", "BOLA", "COPO", "SOFA", "DADO", "FACA", "LIVRO", "CASA", "COLA", "CAMA", "PI√ÉO", "BONECA", "CARRO", "VASO", "PENTE", "L√ÅPIS", "REDE", "MOTO", "RADIO", "TELEFONE", "SAPATO", "MEIA", "BOTA", "CADEIRA", "JANELA"]
    };

    let currentCategory = "animais";
    let wordQueue = [];
    let currentWord = "";
    let isGameActive = true;

    function shuffleArray(array) {
      let newArr = [...array];
      for (let i = newArr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
      }
      return newArr;
    }

    function changeCategory(cat) {
      currentCategory = cat;
      wordQueue = shuffleArray(wordsData[cat]); // Reinicia a fila embaralhada
      
      document.querySelectorAll('.menu button').forEach(b => b.classList.remove('active'));
      document.getElementById(`cat-${cat}`).classList.add('active');
      
      nextLevel();
    }

    function nextLevel() {
      isGameActive = true;
      stopConfetti();
      
      if (wordQueue.length === 0) {
        wordQueue = shuffleArray(wordsData[currentCategory]);
      }
      
      currentWord = wordQueue.shift();
      setupGame();
    }

    function setupGame() {
      document.getElementById("wordToCopy").textContent = currentWord;
      const dropZone = document.getElementById("dropZone");
      const letterBank = document.getElementById("letterBank");
      dropZone.innerHTML = "";
      letterBank.innerHTML = "";
      document.getElementById("message").textContent = "";

      for (let i = 0; i < currentWord.length; i++) {
        let slot = document.createElement("div");
        slot.className = "dropSlot";
        slot.onclick = () => removeLetter(slot);
        dropZone.appendChild(slot);
      }

      let letters = currentWord.split("");
      let shuffledLetters = shuffleArray(letters);
      shuffledLetters.forEach((letter, idx) => {
        let div = document.createElement("div");
        div.className = "letter";
        div.textContent = letter;
        div.dataset.origIdx = idx;
        div.onclick = () => placeLetter(div);
        letterBank.appendChild(div);
      });
    }

    function placeLetter(div) {
      if(!isGameActive) return;
      let slots = document.querySelectorAll(".dropSlot");
      for (let slot of slots) {
        if (slot.textContent === "") {
          slot.textContent = div.textContent;
          slot.classList.add("filled");
          slot.dataset.bankRef = div.dataset.origIdx;
          div.style.visibility = "hidden";
          break;
        }
      }
    }

    function removeLetter(slot) {
      if(!isGameActive || slot.textContent === "") return;
      const bankRef = slot.dataset.bankRef;
      slot.textContent = "";
      slot.classList.remove("filled");
      
      const bankLetters = document.querySelectorAll(".letter");
      bankLetters.forEach(b => {
        if (b.dataset.origIdx === bankRef) b.style.visibility = "visible";
      });
    }

    function checkWord() {
      if(!isGameActive) return;
      let formedWord = "";
      document.querySelectorAll(".dropSlot").forEach(slot => formedWord += slot.textContent);
      const msg = document.getElementById("message");

      if (formedWord === currentWord) {
        isGameActive = false;
        msg.innerHTML = "üéâ PARAB√âNS! VOC√ä CONSEGUIU! üéâ";
        msg.style.color = "#2e7d32";
        startConfetti();
        setTimeout(nextLevel, 2000);
      } else {
        msg.textContent = "Tente de novo! üí™";
        msg.style.color = "#d63a6d";
      }
    }

    // --- SISTEMA DE CONFETES ---
    const canvas = document.getElementById("confettiCanvas");
    const ctx = canvas.getContext("2d");
    let particles = [];
    let animationId;

    function startConfetti() {
      particles = [];
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      for (let i = 0; i < 80; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: -10,
          r: Math.random() * 6 + 4,
          d: Math.random() * 4 + 2,
          color: `hsl(${Math.random() * 360}, 100%, 50%)`
        });
      }
      animate();
    }

    function stopConfetti() {
      cancelAnimationFrame(animationId);
      particles = [];
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach((p, i) => {
        p.y += p.d;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();
        if (p.y > canvas.height) particles.splice(i, 1);
      });
      if (particles.length > 0) animationId = requestAnimationFrame(animate);
    }

    window.onload = () => changeCategory('animais');
</script>
</body>
</html>
