<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
<title>Jogo da Velha</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Baloo+2&display=swap');
  body {
    margin: 0;
    padding: 1.2rem 0 .3rem 0;
    font-family: 'Baloo 2', cursive, Arial, sans-serif;
    background: linear-gradient(135deg, #a2d9ff 0%, #ffc9de 100%);
    color: #222;
    text-align: center;
    min-height: 100vh;
    user-select: none;
    overflow-x: hidden;
  }
  #menuButton {
    position: fixed;
    top: 14px;
    left: 14px;
    z-index: 100;
    padding: 10px 20px;
    font-size: 1.12rem;
    border-radius: 9px;
    border: none;
    background: linear-gradient(135deg, #ff007f, #21a7ff 110%);
    color: #fff;
    font-family: 'Baloo 2', cursive, Arial, sans-serif;
    font-weight: bold;
    box-shadow: 1px 3px 12px #21a7ff63;
    cursor: pointer;
  }
  .header-title {
    margin: 50px 0 18px 0;
    font-size: 2.3rem;
    font-weight: 900;
    color: #ff4c8b;
    text-shadow: 0 3px 16px #f0629222;
    letter-spacing: 1.5px;
  }
  #config, #game {
    margin: 0 auto 1.6rem auto;
    max-width: 430px;
    background: #fff3f7;
    border-radius: 20px;
    padding: 1.1rem 1.4rem;
    box-shadow: 2px 6px 15px rgba(255, 0, 127, 0.15);
    text-align: left;
  }
  label {
    font-weight: 700;
    margin-right: 8px;
  }
  select, input[type="text"] {
    border-radius: 8px;
    border: 2.5px solid #f8bbd0;
    font-family: 'Baloo 2', cursive, Arial, sans-serif;
    height: 36px;
    font-size: 1rem;
    padding: 0 1rem;
    margin-bottom: 1rem;
    width: 100%;
    box-sizing: border-box;
  }
  #config .input-row {
    display: flex;
    gap: 10px;
    margin-bottom: 1rem;
  }
  #config .input-row > div {
    flex: 1;
  }
  button, .btn {
    background: #ff4c8b;
    border: none;
    border-radius: 16px;
    padding: 1rem 2.4rem;
    color: white;
    font-size: 1.09rem;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 6px 20px rgba(255,76,139,0.24);
    margin-top: 1rem;
    width: 100%;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    transition: background 0.3s, transform 0.23s;
  }
  button:hover, .btn:hover {
    background: #e03e72;
    transform: scale(1.05);
  }
  #game {
    display: none;
    text-align: center;
    position: relative;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(3, minmax(87px,1fr));
    grid-template-rows: repeat(3, minmax(87px,1fr));
    gap: 13px;
    justify-content: center;
    margin-top: 15px;
    margin-bottom: 8px;
  }
  .cell {
    background: #ffe3eb;
    border-radius: 14px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 3.7rem;
    font-weight: 900;
    cursor: pointer;
    transition: background-color 0.3s;
    user-select: none;
    box-shadow: 0 4px 12px rgba(255,76,139,0.16);
  }
  .cell:hover {
    background-color: #ffccd7;
  }
  .cell.X {
    color: #f50057;
  }
  .cell.O {
    color: #2e7d32;
  }
  .cell.win {
    background-color: #ff6f91;
    color: white !important;
    box-shadow: 0 0 14px #ff6f91aa;
  }
  #message {
    font-size: 1.19rem;
    font-weight: 700;
    min-height: 27px;
    color: #bf1650;
    margin-top: 13px;
  }
  #controls {
    display: flex;
    justify-content: space-between;
    max-width: 430px;
    margin: 0 auto;
  }
  #confetti {
    pointer-events: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 0;
    z-index: 9999;
  }
  .confetti-piece {
    position: absolute;
    width: 10px;
    height: 14px;
    opacity: 0.85;
    animation-name: confetti-fall, confetti-spin;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
  }
  @keyframes confetti-fall {
    0% { top: -20px; opacity: 1; }
    100% { top: 105vh; opacity: 0; }
  }
  @keyframes confetti-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  @media (max-width: 700px) {
    #config, #game {
      max-width: 97vw;
      padding: 0.6rem 0.17rem;
    }
    #controls {
      max-width: 97vw;
      gap: 5vw;
    }
    #board {
      grid-template-columns: repeat(3, 28vw);
      grid-template-rows: repeat(3, 28vw);
      gap: 3.5vw;
      margin-bottom: 2vw;
    }
    .cell {
      font-size: 11vw;
    }
    #menuButton {
      font-size: 0.97rem;
      padding: 8px 12px;
      left: 6px; top: 6px;
    }
    .header-title {
      font-size: 1.6rem;
      margin: 19vw 0 12px 0;
    }
  }
</style>
</head>
<body>
<button id="menuButton">← Menu de Jogos</button>
<div class="header-title">Jogo da Velha</div>
<div id="config" role="region" aria-label="Configurações do jogo">
  <div class="input-group" style="margin-bottom:1rem;">
    <label for="mode">Selecionar modo de jogo:</label>
    <select id="mode" aria-describedby="modeDesc" style="width:auto; display:inline-block;">
      <option value="1vs1">1 vs 1</option>
      <option value="1vscpu">1 vs Computador</option>
    </select>
    <div id="modeDesc" hidden>Método de jogo: contra outro jogador ou contra o computador.</div>
  </div>
  <div id="players-names" style="margin-bottom:1rem;">
    <div class="input-row" id="players1vs1" style="display:flex; gap:12px;">
      <div>
        <label for="player1-name">Nome do Jogador 1:</label>
        <input type="text" id="player1-name" placeholder="Jogador 1" maxlength="12" value="Jogador 1" />
      </div>
      <div>
        <label for="player2-name">Nome do Jogador 2:</label>
        <input type="text" id="player2-name" placeholder="Jogador 2" maxlength="12" value="Jogador 2" />
      </div>
    </div>
    <div id="player-cpu" style="display:none;">
      <label for="player1-name-cpu">Nome do Jogador:</label>
      <input type="text" id="player1-name-cpu" placeholder="Jogador" maxlength="12" value="Jogador"/>
    </div>
  </div>
  <div id="cpu-difficulty-group" style="display:none; margin-bottom: 1rem;">
    <label for="cpu-difficulty">Dificuldade do computador:</label>
    <select id="cpu-difficulty" aria-describedby="cpuDiffDesc" style="width:auto; display:inline-block;">
      <option value="easy">Fácil</option>
      <option value="medium" selected>Médio</option>
      <option value="hard">Difícil</option>
    </select>
    <div id="cpuDiffDesc" hidden>Escolha a dificuldade do computador.</div>
  </div>
  <button id="startBtn" aria-label="Começar o jogo">Começar</button>
</div>
<div id="game">
  <div id="board" role="grid" aria-label="Tabuleiro do jogo da velha"></div>
  <div id="message" role="alert" aria-live="polite"></div>
  <div id="controls">
    <button id="restartBtn" aria-label="Reiniciar jogo">Reiniciar</button>
    <a href="../index.html" id="btn-return" role="button" aria-label="Voltar para o menu de jogos" class="btn">← Menu de Jogos</a>
  </div>
</div>
<div id="confetti"></div>
<script>
  document.getElementById('menuButton').onclick = function() {
    window.location.href = '../index.html';
  };
  const modeSelect = document.getElementById('mode');
  const player1NameInput = document.getElementById('player1-name');
  const player2NameInput = document.getElementById('player2-name');
  const players1vs1 = document.getElementById('players1vs1');
  const playerCpu = document.getElementById('player-cpu');
  const player1NameCpuInput = document.getElementById('player1-name-cpu');
  const cpuDifficultyGroup = document.getElementById('cpu-difficulty-group');
  const cpuDifficultySelect = document.getElementById('cpu-difficulty');
  const startBtn = document.getElementById('startBtn');
  const gameDiv = document.getElementById('game');
  const configDiv = document.getElementById('config');
  const boardDiv = document.getElementById('board');
  const messageDiv = document.getElementById('message');
  const restartBtn = document.getElementById('restartBtn');
  const confettiContainer = document.getElementById('confetti');

  const winCombos = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];

  let board = Array(9).fill(null);
  let currentPlayer = 'X';
  let gameActive = false;
  let mode = '1vs1';
  let players = ['Jogador 1', 'Jogador 2'];
  let cpuDifficulty = 'medium';
  let winningCells = [];

  modeSelect.addEventListener('change', e => {
    mode = e.target.value;
    if(mode === '1vs1') {
      players1vs1.style.display = 'flex';
      playerCpu.style.display = 'none';
      cpuDifficultyGroup.style.display = 'none';
    } else {
      players1vs1.style.display = 'none';
      playerCpu.style.display = 'block';
      cpuDifficultyGroup.style.display = 'block';
      player1NameCpuInput.value = 'Jogador';
    }
  });

  startBtn.addEventListener('click', () => {
    if(mode === '1vs1') {
      const p1 = player1NameInput.value.trim() || 'Jogador 1';
      const p2 = player2NameInput.value.trim() || 'Jogador 2';
      players = [p1, p2];
    } else {
      const p1 = player1NameCpuInput.value.trim() || 'Jogador';
      players = [p1, 'Computador']; 
    }
    cpuDifficulty = cpuDifficultySelect.value;
    configDiv.style.display = 'none';
    gameDiv.style.display = 'block';
    messageDiv.textContent = `${players[0]} (X) começa!`;
    initGame();
  });

  restartBtn.addEventListener('click', () => {
    clearConfetti();
    initGame();
  });

  function initGame() {
    clearConfetti();
    board.fill(null);
    currentPlayer = 'X';
    gameActive = true;
    clearBoard();
    winningCells = [];
    messageDiv.textContent = `${players[0]} (X) começa!`;
    renderBoard();
    if(mode === '1vscpu' && currentPlayer === 'O') {
      setTimeout(cpuPlay, 600);
    }
  }

  function clearBoard() {
    boardDiv.innerHTML = '';
  }

  function renderBoard() {
    boardDiv.innerHTML = '';
    boardDiv.style.position = 'relative';
    for(let i=0; i<9; i++) {
      const cell = document.createElement('div');
      cell.classList.add('cell');
      if(winningCells.includes(i)) cell.classList.add('win');
      cell.dataset.index = i;
      if(board[i]) {
        cell.textContent = board[i];
        cell.classList.add(board[i]);
      }
      cell.addEventListener('click', onCellClick);
      boardDiv.appendChild(cell);
    }
  }

  function onCellClick(e) {
    const idx = +e.target.dataset.index;
    if(!gameActive || board[idx]) return;
    if(mode === '1vscpu' && currentPlayer === 'O') return;
    makeMove(idx, currentPlayer);
    if(gameActive) {
      switchPlayer();
      if(mode === '1vscpu' && currentPlayer === 'O') {
        setTimeout(cpuPlay, 650);
      }
    }
  }

  function makeMove(idx, player) {
    board[idx] = player;
    const winInfo = checkWin(player);
    if(winInfo) {
      gameActive = false;
      winningCells = winInfo;
      messageDiv.textContent = `${players[player === 'X' ? 0 : 1]} venceu! 🎉`;
      renderBoard();
      showConfetti();
    } else if(board.every(cell => cell !== null)) {
      gameActive = false;
      winningCells = [];
      messageDiv.textContent = "Empate! 🤝";
      renderBoard();
      clearConfetti();
    } else {
      renderBoard();
    }
  }

  function switchPlayer() {
    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
    const playerName = players[currentPlayer === 'X' ? 0 : 1];
    if(!gameActive) return;
    messageDiv.textContent = `Vez de ${playerName} (${currentPlayer})`;
  }

  function checkWin(player) {
    for(let combo of winCombos) {
      if(combo.every(i => board[i] === player)) {
        return combo;
      }
    }
    return null;
  }

  function cpuPlay() {
    switch(cpuDifficulty) {
      case 'easy': playRandom(); break;
      case 'medium': if(!tryToWinOrBlock()) playRandom(); break;
      case 'hard': if(!tryToWinOrBlock()) playPerfect(); break;
    }
  }

  function playRandom() {
    const freePositions = board.map((v,i) => v === null ? i : null).filter(i => i !== null);
    if(freePositions.length === 0) return;
    const idx = freePositions[Math.floor(Math.random() * freePositions.length)];
    makeMove(idx, currentPlayer);
    switchPlayer();
  }

  function tryToWinOrBlock() {
    const target = findWinningOrBlockingMove(currentPlayer) || findWinningOrBlockingMove(currentPlayer === 'X' ? 'O' : 'X');
    if(target !== null) {
      makeMove(target, currentPlayer);
      switchPlayer();
      return true;
    }
    return false;
  }

  function findWinningOrBlockingMove(player) {
    for(let combo of winCombos) {
      const vals = combo.map(i => board[i]);
      if(vals.filter(v => v===player).length === 2 && vals.includes(null)) {
        return combo[vals.indexOf(null)];
      }
    }
    return null;
  }

  function playPerfect() {
    let bestScore = -Infinity;
    let move;
    for(let i = 0; i < 9; i++) {
      if(board[i] === null) {
        board[i] = currentPlayer;
        let score = minimax(board, false);
        board[i] = null;
        if(score > bestScore) {
          bestScore = score;
          move = i;
        }
      }
    }
    if(move !== undefined) {
      makeMove(move, currentPlayer);
      switchPlayer();
    } else {
      playRandom();
    }
  }

  function minimax(brd, isMaximizing) {
    let winner = checkWinner(brd);
    if(winner !== null) {
      if(winner === currentPlayer) return 10;
      else if(winner === 'tie') return 0;
      else return -10;
    }
    if(isMaximizing) {
      let bestScore = -Infinity;
      for(let i=0; i<9; i++) {
        if(brd[i] === null) {
          brd[i] = currentPlayer;
          let score = minimax(brd, false);
          brd[i] = null;
          bestScore = Math.max(score, bestScore);
        }
      }
      return bestScore;
    } else {
      let opponent = currentPlayer === 'X' ? 'O' : 'X';
      let bestScore = Infinity;
      for(let i=0; i<9; i++) {
        if(brd[i] === null) {
          brd[i] = opponent;
          let score = minimax(brd, true);
          brd[i] = null;
          bestScore = Math.min(score, bestScore);
        }
      }
      return bestScore;
    }
  }

  function checkWinner(brd) {
    for(let combo of winCombos) {
      const [a,b,c] = combo;
      if(brd[a] && brd[a] === brd[b] && brd[a] === brd[c]) {
        return combo;
      }
    }
    if(brd.every(cell => cell !== null)) return 'tie';
    return null;
  }

  function showConfetti() {
    clearConfetti();
    const colors = ['#f44336','#ffeb3b','#4caf50','#2196f3','#ff9800','#9c27b0','#00bcd4','#ffc107'];
    const count = 150;
    for(let i=0; i<count; i++) {
      let confetti = document.createElement('div');
      confetti.className = 'confetti-piece';
      confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      confetti.style.left = Math.random() * window.innerWidth + 'px';
      confetti.style.animationDuration = (2 + Math.random() * 3) + 's';
      confetti.style.animationDelay = (Math.random() * 2) + 's';
      confettiContainer.appendChild(confetti);
    }
    setTimeout(clearConfetti, 7000);
  }

  function clearConfetti() {
    confettiContainer.innerHTML = '';
  }
</script>
</body>
</html>
